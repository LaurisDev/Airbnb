<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ alojamiento[1] }} - Rinconcito</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="static/estilos.css">
</head>
<body class="bg-gray-50">

    <!-- Barra de navegación -->
    <nav class="bg-white shadow-sm py-4 px-6 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center">
            <a href="/" class="text-xl font-bold text-purple-500">Rinconcito</a>
        </div>
        <div class="flex items-center space-x-4">
            <a href="/" class="text-gray-600 hover:text-purple-500 transition duration-200">
                <i class="fas fa-arrow-left mr-2"></i>Volver
            </a>
        </div>
    </nav>

    <!-- Contenido principal -->
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Columna izquierda - Imagen y descripción -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Imagen principal -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <img src="{{ alojamiento[4] }}" alt="{{ alojamiento[1] }}" class="w-full h-[500px] object-cover">
                </div>

                <!-- Información del alojamiento -->
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <div class="mb-4">
                        <h1 class="text-3xl font-bold text-gray-800 mb-2">{{ alojamiento[1] }}</h1>
                

                        <div class="flex items-center">
                            <i class="fas fa-star text-purple-500 mr-1"></i>
                            <span class="font-medium">{{ alojamiento[5] }}</span>
                            <span class="text-gray-500 ml-2">• Excelente ubicación</span>
                        </div>
                    </div>

                    <!-- Descripción -->
                    <div>
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Descripción</h2>
                        <p class="text-gray-700 leading-relaxed">{{ alojamiento[2] }}</p>
                    </div>

                    <!-- Calendario de Disponibilidad -->
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Disponibilidad - {{ calendario.nombre_mes }} {{ calendario.año }}</h3>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <!-- Días de la semana -->
                            <div class="grid grid-cols-7 gap-1 mb-2">
                                <div class="text-center text-sm font-semibold text-gray-600 py-2">Dom</div>
                                <div class="text-center text-sm font-semibold text-gray-600 py-2">Lun</div>
                                <div class="text-center text-sm font-semibold text-gray-600 py-2">Mar</div>
                                <div class="text-center text-sm font-semibold text-gray-600 py-2">Mié</div>
                                <div class="text-center text-sm font-semibold text-gray-600 py-2">Jue</div>
                                <div class="text-center text-sm font-semibold text-gray-600 py-2">Vie</div>
                                <div class="text-center text-sm font-semibold text-gray-600 py-2">Sáb</div>
                            </div>
                            
                            <!-- Días del calendario -->
                            {% for semana in calendario.dias %}
                                <div class="grid grid-cols-7 gap-1">
                                    {% for dia in semana %}
                                        {% if dia is none %}
                                            <div class="py-2"></div>
                                        {% else %}
                                            <div class="py-2 px-1 text-center text-sm rounded
                                                {% if dia.pasado %}
                                                    bg-gray-100 text-gray-400
                                                {% elif dia.ocupado %}
                                                    bg-red-100 text-red-800 font-medium
                                                {% else %}
                                                    bg-green-100 text-green-800 font-medium
                                                {% endif %}">
                                                {{ dia.dia }}
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            {% endfor %}
                            
                            <!-- Leyenda -->
                            <div class="mt-4 flex items-center justify-center space-x-4 text-xs">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-100 border border-green-300 rounded mr-2"></div>
                                    <span class="text-gray-600">Disponible</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-red-100 border border-red-300 rounded mr-2"></div>
                                    <span class="text-gray-600">Ocupado</span>
                                </div>
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-gray-100 border border-gray-300 rounded mr-2"></div>
                                    <span class="text-gray-600">Pasado</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Capacidad -->
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-800 mb-3">Capacidad</h3>
                        <div class="flex items-center text-gray-700">
                            <i class="fas fa-users text-purple-500 mr-3 text-lg"></i>
                            <span class="text-lg">{{ alojamiento[6] }} huésped{% if alojamiento[6] > 1 %}es{% endif %}</span>
                        </div>
                    </div>
                </div>

                <!-- Sección de Reseñas -->
                <div class="bg-white rounded-xl shadow-lg p-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Reseñas</h2>
                        {% if usuario_logueado %}
                            <a href="{{ url_for('agregar_resena_pagina', alojamiento_id=alojamiento[0]) }}" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition duration-200">
                                <i class="fas fa-plus mr-2"></i>Agregar Reseña
                            </a>
                        {% else %}
                            <a href="{{ url_for('login', next=request.url) }}" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition duration-200">
                                <i class="fas fa-sign-in-alt mr-2"></i>Iniciar Sesión para Reseñar
                            </a>
                        {% endif %}
                    </div>

                    <!-- Mensajes flash específicos para reseñas -->
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                {% if category.startswith('success_resenas') or category.startswith('error_resenas') %}
                                    <div class="mb-4 p-4 rounded-lg {% if category == 'error_resenas' %}bg-red-100 text-red-700 border border-red-300{% elif category == 'success_resenas' %}bg-green-100 text-green-700 border border-green-300{% else %}bg-blue-100 text-blue-700 border border-blue-300{% endif %}">
                                        {{ message }}
                                    </div>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    {% endwith %}



                    <!-- Lista de reseñas -->
                    <div id="lista-resenas">
                        {% if resenas %}
                            {% for resena in resenas %}
                            <div class="border-b border-gray-200 pb-6 mb-6 last:border-b-0">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center">
                                        <div class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center text-white font-semibold mr-3">
                                            {{ resena[4][0] }}{{ resena[5][0] }}
                                        </div>
                                        <div>
                                            <p class="font-semibold text-gray-800">{{ resena[4] }} {{ resena[5] }}</p>
                                            <p class="text-sm text-gray-500">{{ resena[3].strftime('%d/%m/%Y') }}</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center">
                                        {% for i in range(1, 6) %}
                                            <i class="fas fa-star {% if i <= resena[2] %}text-purple-500{% else %}text-gray-300{% endif %}"></i>
                                        {% endfor %}
                                    </div>
                                </div>
                                <p class="text-gray-700">{{ resena[1] }}</p>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="text-center py-8">
                                <i class="fas fa-comments text-gray-300 text-4xl mb-4"></i>
                                <p class="text-gray-500">Aún no hay reseñas para este alojamiento.</p>
                                <p class="text-gray-400 text-sm">¡Sé el primero en compartir tu experiencia!</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Columna derecha - Formulario de reserva -->
            <div class="lg:col-span-1 lg:sticky lg:top-24">
                <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-5 max-w-sm mx-auto lg:mx-0">
                    <div class="mb-4">
                        <div class="flex items-baseline gap-1">
                            <p class="text-2xl font-bold text-gray-800">€{{ alojamiento[3] }}</p>
                            <p class="text-gray-600">noche</p>
                        </div>
                        <div id="total-price" class="hidden mt-2 pt-2 border-t border-gray-200">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700">Total:</span>
                                <span class="text-lg font-semibold text-gray-800" id="total-amount">€0</span>
                            </div>
                        </div>
                    </div>

                    <!-- Formulario de reserva -->
                    <form action="{{ url_for('resumen_reserva', alojamiento_id=alojamiento[0]) }}" method="POST" class="space-y-4">
                        <!-- Fechas -->
                        <div class="border border-gray-300 rounded-lg overflow-hidden">
                            <div class="grid grid-cols-2">
                                <div class="border-r border-gray-300">
                                    <label for="checkin" class="block text-xs font-medium text-gray-700 px-3 pt-3">Check-in</label>
                                    <input type="date" id="checkin" name="checkin" required value="{{ checkin }}"
                                           class="w-full px-3 pb-3 text-sm border-0 focus:ring-0 focus:outline-none">
                                </div>
                                <div>
                                    <label for="checkout" class="block text-xs font-medium text-gray-700 px-3 pt-3">Check-out</label>
                                    <input type="date" id="checkout" name="checkout" required value="{{ checkout }}"
                                           class="w-full px-3 pb-3 text-sm border-0 focus:ring-0 focus:outline-none">
                                </div>
                            </div>
                        </div>
                        <!-- Mensajes de error para fechas -->
                        <div id="fecha-error" class="hidden text-red-500 text-xs px-3 py-2 bg-red-50 rounded-lg">
                            <i class="fas fa-exclamation-triangle mr-1"></i>
                            <span id="fecha-error-text"></span>
                        </div>
                        
                        <!-- Huéspedes -->
                        <div class="border border-gray-300 rounded-lg">
                            <label for="guests" class="block text-xs font-medium text-gray-700 px-3 pt-3">Huéspedes</label>
                            <select id="guests" name="guests" required class="w-full px-3 pb-3 text-sm border-0 focus:ring-0 focus:outline-none bg-transparent">
                                <option value="">¿Cuántos?</option>
                                {% for i in range(1, alojamiento[6] + 1) %}
                                <option value="{{ i }}" {% if guests == i|string %}selected{% endif %}>
                                    {{ i }} Huésped{% if i > 1 %}es{% endif %}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="px-3 pb-2">
                                <p class="text-xs text-gray-500">Capacidad máxima: {{ alojamiento[6] }} huésped{% if alojamiento[6] > 1 %}es{% endif %}</p>
                            </div>
                        </div>

                        <!-- Botón de reserva -->
                        <button type="submit" id="btn-reservar" class="w-full bg-purple-500 text-white py-4 px-4 rounded-lg font-semibold text-base hover:bg-purple-600 transition duration-200">
                            Reservar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
<script>
    // Función para calcular el precio total de la reserva

function initPriceCalculation(pricePerNight) {
    const checkinInput = document.getElementById('checkin');
    const checkoutInput = document.getElementById('checkout');
    const totalPriceDiv = document.getElementById('total-price');
    const totalAmount = document.getElementById('total-amount');

    if (!checkinInput || !checkoutInput || !totalPriceDiv || !totalAmount) return;

    function calculateTotal() {
        const checkin = new Date(checkinInput.value);
        const checkout = new Date(checkoutInput.value);

        if (checkin && checkout && checkout > checkin) {
            const diffTime = checkout - checkin;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const total = diffDays * pricePerNight;

            totalAmount.textContent = '€' + total;
            totalPriceDiv.classList.remove('hidden');
        } else {
            totalAmount.textContent = '€0';
            totalPriceDiv.classList.add('hidden');
        }
    }

    checkinInput.addEventListener('change', calculateTotal);
    checkoutInput.addEventListener('change', calculateTotal);
    if (checkinInput.value && checkoutInput.value) {
        calculateTotal(); 
    }
}
    document.addEventListener('DOMContentLoaded', function () {
        initPriceCalculation(parseFloat("{{ alojamiento[3] }}"));
        
        // Validación de capacidad de huéspedes
        const guestsSelect = document.getElementById('guests');
        const capacidadMaxima = parseInt("{{ alojamiento[6] }}");
        
        if (guestsSelect) {
            guestsSelect.addEventListener('change', function() {
                const selectedGuests = parseInt(this.value);
                if (selectedGuests > capacidadMaxima) {
                    alert('Lo sentimos, este alojamiento solo puede alojar hasta ' + capacidadMaxima + ' huésped' + (capacidadMaxima > 1 ? 'es' : '') + '.');
                    this.value = '';
                }
            });
        }
        
        // Validación de fechas pasadas
        const form = document.querySelector('form');
        const btnReservar = document.getElementById('btn-reservar');
        const fechaError = document.getElementById('fecha-error');
        const fechaErrorText = document.getElementById('fecha-error-text');
        
        function validarFechas() {
            const checkinInput = document.getElementById('checkin');
            const checkoutInput = document.getElementById('checkout');
            
            if (checkinInput && checkoutInput && checkinInput.value && checkoutInput.value) {
                const checkin = new Date(checkinInput.value);
                const checkout = new Date(checkoutInput.value);
                const today = new Date();
                
                // Resetear la fecha de hoy a medianoche para comparación precisa
                today.setHours(0, 0, 0, 0);
                
                // Validar que las fechas no sean pasadas
                if (checkin < today) {
                    fechaErrorText.textContent = 'No puedes seleccionar una fecha de check-in en el pasado.';
                    fechaError.classList.remove('hidden');
                    return false;
                }
                
                if (checkout < today) {
                    fechaErrorText.textContent = 'No puedes seleccionar una fecha de check-out en el pasado.';
                    fechaError.classList.remove('hidden');
                    return false;
                }
                
                // Validar que checkout sea posterior a checkin
                if (checkout <= checkin) {
                    fechaErrorText.textContent = 'La fecha de check-out debe ser posterior a la fecha de check-in.';
                    fechaError.classList.remove('hidden');
                    return false;
                }
                
                // Si todo está bien, ocultar el error
                fechaError.classList.add('hidden');
                return true;
            }
            
            // Si no hay fechas seleccionadas, ocultar el error
            fechaError.classList.add('hidden');
            return true;
        }
        
        if (form && btnReservar) {
            // Validar fechas en tiempo real
            const checkinInput = document.getElementById('checkin');
            const checkoutInput = document.getElementById('checkout');
            
            if (checkinInput) {
                checkinInput.addEventListener('change', validarFechas);
            }
            if (checkoutInput) {
                checkoutInput.addEventListener('change', validarFechas);
            }
            
            // Validar al enviar el formulario
            form.addEventListener('submit', function(e) {
                if (!validarFechas()) {
                    e.preventDefault();
                    return false;
                }
            });
        }
    });


</script>
</body>
</html> 